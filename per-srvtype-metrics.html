<html>
  <head>
    <title>Srvtype-specific Vulnerability Metrics</title>
    <script type="text/javascript" src="https://www.google.com/jsapi"></script>
    <script src="https://code.jquery.com/jquery-1.8.2.js"></script>
    <script src="https://code.jquery.com/ui/1.9.0/jquery-ui.js"></script>
    <script src="jquery.csv.js"></script>
    <script type="text/javascript">
    // load the visualization library from Google and set a listener
    google.load("visualization", "1", {packages:["corechart"]});
    google.setOnLoadCallback(drawChart);
    parser = location;
    srvtype = parser.hash;
    srvtype = srvtype.slice(1)

    // this has to be a global function
    function drawChart() {
        // grab the CSV
        $.get(srvtype +"/category.csv", function(csvString) {
        // transform the CSV string into a 2-dimensional array
        var arrayData = $.csv.toArrays(csvString, {onParseValue: $.csv.hooks.castToScalar});

        // this new DataTable object holds all the data
        var data = new google.visualization.arrayToDataTable(arrayData);

        // this view can select a subset of the data at a time
        var view = new google.visualization.DataView(data);
        view.setColumns([0,1]);

        // set chart options
        var options = {
        title: "What does " + srvtype + "'s risk score consist of?",
        hAxis: {minValue: data.getColumnRange(0).min, maxValue: data.getColumnRange(0).max},
        vAxis: {minValue: data.getColumnRange(1).min, maxValue: data.getColumnRange(1).max},
        width: 400,
        height: 325,
        };
        var chart = new google.visualization.PieChart(document.getElementById('categorychart'));
        chart.draw(view, options);
        });

        $.get(srvtype +"/host.csv", function(csvString) {
        // transform the CSV string into a 2-dimensional array
        var arrayData = $.csv.toArrays(csvString, {onParseValue: $.csv.hooks.castToScalar});

        // this new DataTable object holds all the data
        var data = new google.visualization.arrayToDataTable(arrayData);

        // this view can select a subset of the data at a time
        var view = new google.visualization.DataView(data);
        view.setColumns([0,1,{sourceColumn: 2, type: "string", role: "annotation"}]);
        
        // set chart options
        var options = {
          title: "Which " + srvtype + " hosts have the most vulnerabilities / highest risk?",
          hAxis: {title: data.getColumnLabel(0), minValue: data.getColumnRange(0).min, maxValue: data.getColumnRange(0).max},
          vAxis: {title: data.getColumnLabel(1), minValue: data.getColumnRange(1).min, maxValue: data.getColumnRange(1).max},
          legend: {position: 'none'},
          width: 400,
          height: 325,
        };
        var chart = new google.visualization.ScatterChart(document.getElementById('hostchart'));
        chart.draw(view, options);
        });

        $.get(srvtype +"/severity.csv", function(csvString) {
        // transform the CSV string into a 2-dimensional array
        var arrayData = $.csv.toArrays(csvString, {onParseValue: $.csv.hooks.castToScalar});

        // this new DataTable object holds all the data
        var data = new google.visualization.arrayToDataTable(arrayData);

        // this view can select a subset of the data at a time
        var view = new google.visualization.DataView(data);
        view.setColumns([0,1]);

        // set chart options
        var options = {
          title: "How many of " + srvtype + "'s vulnerabilities are critical?",
          hAxis: {minValue: data.getColumnRange(0).min, maxValue: data.getColumnRange(0).max},
          vAxis: {minValue: data.getColumnRange(1).min, maxValue: data.getColumnRange(1).max},
          width: 400,
          height: 325,
          colors: ['blue', 'orange', 'red'],
        };
        var chart = new google.visualization.PieChart(document.getElementById('severitychart'));
        chart.draw(view, options);
        });
      }
    </script>
  </head>
  <body>
    <table class="columns">
      <tr>
        <td><div id="categorychart" style="border: 1px solid #ccc"></div></td>
        <td><div id="hostchart" style="border: 1px solid #ccc"></div></td>
        <td><div id="severitychart" style="border: 1px solid #ccc"></div></td>
      </tr>
    </table>
  </body>
</html>
