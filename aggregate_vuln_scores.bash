#!/bin/bash
# quick tool for inspecting $SRVTYPE.csv before gen_srvtype_metrics chops it up into 3 csv

file=$1

#echo "Aggregate Vulnerability Score Report for ${file%*.csv}"
IFS=$'\n'
echo "aggregate risk,vulnerability title"
(cut -d, -f3 "$file" | sort | uniq | while read vuln; do
        vuln_score=0;
        for score in $(grep "${vuln}" "$file" | cut -d, -f4); do
                vuln_score=$(echo "$vuln_score + $score" | bc -l)
        done
        echo "$vuln,$vuln_score" 
done) | sort -t, -k1 -nr
unset IFS
