<html>
  <head>
    <title>Monthly Risk by Srvtype</title>
    <script type="text/javascript" src="https://www.google.com/jsapi"></script>
    <script src="https://code.jquery.com/jquery-1.8.2.js"></script>
    <script src="https://code.jquery.com/ui/1.9.0/jquery-ui.js"></script>
    <script src="jquery.csv.js"></script>
    <script src="moment.js"></script>
    <script type="text/javascript">
    // load the visualization library from Google and set a listener
    google.load("visualization", "1", {packages:["corechart"]});
    google.setOnLoadCallback(drawChart);

    // this has to be a global function
    function drawChart() {
    // grab the CSV
    $.get("srvtype-risk-metrics.csv", function(csvString) {
      // transform the CSV string into a 2-dimensional array
      var arrayData = $.csv.toArrays(csvString, {onParseValue: $.csv.hooks.castToScalar});

      // this new DataTable object holds all the data
      var data = new google.visualization.arrayToDataTable(arrayData);

      // this view can select a subset of the data at a time
      var view = new google.visualization.DataView(data);
      view.setColumns([0,3,{ calc: "stringify", sourceColumn: 3, type: "string", role: "annotation"}]);
      var chartTitle = "Monthly Risk by Srvtype - " + moment().format('MMM. YYYY')

      // set chart options
      var options = {
        title: chartTitle,
        hAxis: {minValue: data.getColumnRange(0).min, maxValue: data.getColumnRange(0).max},
        vAxis: {minValue: data.getColumnRange(3).min, maxValue: data.getColumnRange(3).max, textStyle: {fontSize: 12}, showTextEvery: 1},
        legend: {'position': 'bottom'},
        chartArea: {'width': '80%', 'height': '94%'},
        seriesType: 'bars',
        width: 1800,
        height: 2200
     };
     var chart = new google.visualization.BarChart(document.getElementById('chart'));
     // The select handler. Call the chart's getSelection() method
     function selectHandler() {
       var selectedItem = chart.getSelection()[0];
       if (selectedItem) {
         var srvtype = data.getValue(selectedItem.row, 0);
         window.location.href = 'srvtype.html#' + srvtype
       }
     }
     // Listen for the 'select' event, and call my function selectHandler() when
     // the user selects something on the chart.
     google.visualization.events.addListener(chart, 'select', selectHandler);
     chart.draw(view, options);
  });
}
    </script>
  </head>
  <body>
    <div id="chart" style="width:1800; height:2200"></div>
  </body>
</html>
